# 0-0

## ワールド

p5play の各インスタンスには、物理シミュレーションを制御するために使用できる独自の `world` オブジェクトがあります。

このオブジェクトの最も重要なプロパティは `gravity` で、x 成分と y 成分を持っています。

# 0-1

## スリープ

`world.allowSleeping` はデフォルトで true です。

スプライトは、動きを止めて新たに何も衝突しないときに "sleeping" 状態になります。 "Sleeping" スプライトは物理シミュレーション中に無視されるため、通常は Box2D 物理エンジンソルバが不必要な計算を行う必要がなくなります。これはパフォーマンスには良いですが、場合によっては問題を引き起こすこともあります。

スプライトを起こすには `sprite.sleeping` を false に設定します。また、 `sprite.allowSleeping` を false に設定することで、スプライトごとにスリープを無効にすることもできます。

# 1-0

## 時間の制御

デフォルトでは、p5.js の draw 関数が実行されるたびに、p5play は以下の 3 つの関数をこの順序で呼び出します：

- `allSprites.draw()` ： すべてのスプライトを描画します
- `world.step()` ： 物理シミュレーションを進めます
- `allSprites.update()` ： sprite.ani と sprite.mouse を更新します

しかし、これらのプロセスを自分で呼び出すことで手動で制御することもできます。

ミニ例では、スペースを押してスローモーションを切り替えてみてください！

## sprite.draw と group.draw

p5.js の draw ループ内で個々のスプライトとグループを描画するタイミングを手動で制御するために、`sprite.draw` と `group.draw` 関数を使用できます。手動で描画されなかったスプライトは、スプライトの autoDraw プロパティが直接または親グループのいずれかによって false に設定されていない限り、p5.js の draw ループの終わりに自動的に描画されます。自動描画を完全に防ぐには `allSprites.autoDraw = false` を設定します。

手動で描画したスプライトを使ってカメラをオンにしたりオフにしたりする場合は、手動でオンオフを切り替える必要があります。

# 1-1

## world.step

`world.step` は、デフォルトで 1/60 秒進行した物理シミュレーションの後で、すべてのスプライトの衝突をチェックし、位置と速度を計算します。スプライトは個別に時間を進めることはできません。

p5.js の draw 関数で `world.step` を使用する前に、すべてのスプライトを描画しておくことが重要です。そうしないと、スプライトが間違った位置に描画されます！

自動ステップを無効にするには `world.autoStep = false` を設定します。それから、物理シミュレーションを進行させたいときにいつでも手動で `world.step` を呼び出すことができます。

# 1-2

## sprite.update と group.update

`sprite.update` は何をしますか？これは、スプライトのアニメーションとマウスイベントの更新を担当します。また、ユーザーが何かを設定した場合は、ユーザーのカスタム更新関数も実行します。完全な自動更新を防ぐには `allSprites.autoUpdate = false` を設定します。

なぜこの機能はワールドステップから分離されているのですか？というのも、一時停止画面では物理ワールドが一時停止している可能性がありますが、一時停止メニューの UI アニメーションとマウスイベントは引き続き更新される可能性があるからです。

# 2-0

## パフォーマンステスト

`renderStats` 関数は、描画されたスプライトの数、現在の FPS の近似値、前の 1 秒間に達成した平均、最小、最大 FPS を表示します。

このコンテキストでの FPS は、コンピュータが 1 秒間に生成できるフレーム数を指します。これにはフレームを生成するために必要な物理計算や、フレームが実際に画面に表示されるまでの遅延は含まれません。FPS が高いほど、ゲームのパフォーマンスが向上します。

この関数は、おおよそのパフォーマンステストに使用できます。より正確な結果を得るには、ウェブブラウザのパフォーマンステストツールを使用してください。

一般的に、スプライトの数を少なくし、小さなキャンバスを使用すると、ゲームのパフォーマンスが向上します。パフォーマンスを向上させるために、p5.js の `clear` 関数を使用しないか、キャンバスのピクセルの色をサンプリングすることは避けてください。
